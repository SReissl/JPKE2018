# 1. Equations
# 1.1 Identities
# Households
sav_h=WB+F_b+F_f+r_m(-1)*M(-1)+r_cp(-1)*cp(-1)+r_gb(-1)*gb_h(-1)-C
V_h=M+cp+gb_h
M=M(-1)+sav_h-(cp-cp(-1))-(gb_h-gb_h(-1))
#Firms
sav_f=C+G+(INV-INV(-1))-T-WB-F_f-r_l(-1)*l(-1)-r_cp(-1)*cp(-1)
V_f=INV-l-cp
INV=inv*UC
l=l(-1)+(INV-INV(-1))-(cp-cp(-1))-sav_f
F_f=C+G+(INV-INV(-1))-T-WB-r_l(-1)*l(-1)-r_cp(-1)*cp(-1)
cred=l+cp
#banks
sav_b=r_h*H(-1)+r_l(-1)*l(-1)-r_m(-1)*M(-1)-F_b
V_b=H+l-M
F_b=r_h*H(-1)+r_l(-1)*l(-1)-r_m(-1)*M(-1)
#government
sav_g=T-G-r_gb*gb(-1)+PCB
V_g=-gb
gb=gb(-1)-sav_g
#CB
sav_cb=r_gb*gb_cb(-1)-r_h*H(-1)-PCB
PCB=r_gb*gb_cb(-1)-r_h*H(-1)
V_cb=gb_cb-H
gb_cb=gb-gb_h
H=gb_cb
#1.2 Behaviour
#households
YD=WB+F_b+F_f+r_m(-1)*M(-1)+r_cp(-1)*cp(-1)+r_gb(-1)*gb_h(-1)
YD_e=YD_e(-1)+psi*(YD(-1)-YD_e(-1))
V_he=V_h(-1)
c=a1*YD_e/p+a2*V_he/p
C=c*p
epsilon1=(cp-lambda10*V_he+lambda13*r_m*V_he+lambda12*r_gb*V_he+lambda14*YD_e-lambda11*r_h*V_he)/(lambda11*V_he)
r_cp=r_h+epsilon1
gb_h=(lambda20-lambda21*(r_h+epsilon1)+lambda22*(r_gb)-lambda23*r_m)*V_he-lambda24*YD_e-int
#Firms
s=c+g
S=s*p
s_e=s_e(-1)+psi*(s(-1)-s_e(-1))
inv_t=gamma_inv*s_e
gamma_inv=gamma1-gamma2*r_av
r_av=r_l(-1)*l(-1)/(l(-1)+cp(-1))+r_cp(-1)*cp(-1)/(cp(-1)+l(-1))
INV_t=inv_t*UC
y=s_e+psi*(inv_t-inv(-1))
Y=s*p+(INV-INV(-1))
inv=inv(-1)+y-s
N_d=y/alpha
WB=w*N_d
UC=w*N_d/y
p=(1+theta)*w/alpha
cp=cp(-1)+chi_cp*(INV-INV(-1))
chi_cp=ifelse(INV-INV(-1)>=0,chi_1+chi_2*(r_l(-1)-r_cp(-1)),chi_1-chi_2*(r_l(-1)-r_cp(-1)))
#banks
r_l=r_l(-1)+psi*(r_cp(-1)-r_l(-1))
r_m=r_l-2*epsilon2
#Gov
T=tau/(1+tau)*S
G=g*p
r_gb=r_h
#Aux
MS=H+M
#2.parameters
int=0
chi_1=0.5
chi_2=10
g=200
tau=0.25
gamma1=1
gamma2=200
r_h=0.02
epsilon2=0.01
theta=0.5
w=1
alpha=1
psi=0.5
a1=0.825
a2=0.1
lambda10=0.237401277584204
lambda11=0.25
lambda12=0.5
lambda13=0.25
lambda14=0.025
lambda20=0.25
lambda21=0.25
lambda22=0.25
lambda23=0.5
lambda24=0.025
#3.Initial values
r_h1=0.02
inv=1103.1111111111
INV=1103.1111111111
s=1111.1111111111
s_e=1111.11111111111
YD=1366.6666666667
YD_e=1366.6666666667
V_h=2391.666666666667
V_he=2391.666666667
r_gb=0.02
r_m=0.03
r_l=0.04
r_cp=0.04
M=1294.298611111
cp=551.55555555556
gb=1666.66666666667
gb_h=545.81250000000001
gb_cb=1120.8541666666667
H=1120.8541666666667
l=551.5555555555556
epsilon1=0.02
#4.Timeline
timeline 1 500